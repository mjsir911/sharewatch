<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>test</title>
<style type="text/css">
</style>
</head>
<body>
	<form onsubmit="video.src = vUrl.value; return false">
		<input id="vUrl">
		<input type="submit">
	</form>
<video id="video" controls</video>
	
	<script type="text/javascript">
		var vid = document.querySelector("video")
		vid.seek = function(time) {
			vid.pause()
			console.log(time)
			console.log(vid.currentTime)
			if (Math.abs(time - vid.currentTime) > 1) {
				vid.currentTime = time
			}
		}
		var ws = new WebSocket('ws://' + window.location.host + '/ws')
		ws.addEventListener('message', e => {
			payload = JSON.parse(e.data)
			args = payload["args"] || []
			vid[payload["event"]](...args)
		})
		vid.addEventListener("play", (e) => ws.send(JSON.stringify({"event": "play"})))
		vid.addEventListener("pause", (e) => ws.send(JSON.stringify({"event": "pause"})))
		vid.addEventListener("seeked", (e) => ws.send(JSON.stringify({"event": "seek", "args": [vid.currentTime]})))
	</script>
</body>
</html>
